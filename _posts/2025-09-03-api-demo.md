---
layout: post
title: "MinerU API Demo with Python"
date: 2025-09-03 
categories: python
---

此乃附加题。
<!--more-->

Python示例代码如下（以`2024年学生IT手册.pdf`为例）：

```python
import requests
import time

token = "ExampleToken1234567890"
pdf_file_path = "2024年学生IT手册.pdf"
file_name = pdf_file_path  # 一般就是文件名

# 1. 申请上传链接
apply_url = "https://mineru.net/api/v4/file-urls/batch"
header = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {token}"
}
data = {
    "enable_formula": True,
    "language": "ch",
    "enable_table": True,
    "files": [
        {"name": file_name, "is_ocr": True}
    ]
}

resp = requests.post(apply_url, headers=header, json=data)
resp.raise_for_status()
result = resp.json()
if result["code"] != 0:
    raise Exception("申请上传链接失败: " + str(result))

batch_id = result["data"]["batch_id"]
upload_urls = result["data"]["file_urls"]
upload_url = upload_urls[0]

# 2. 上传文件（PUT）
with open(pdf_file_path, 'rb') as f:
    upload_resp = requests.put(upload_url, data=f)
    upload_resp.raise_for_status()
print("文件上传成功，等待自动解析...")

# 3. 轮询获取解析结果
get_result_url = f"https://mineru.net/api/v4/extract-results/batch/{batch_id}"
for i in range(30):
    time.sleep(5)  # 等5秒再查
    poll_resp = requests.get(get_result_url, headers=header)
    poll_resp.raise_for_status()
    poll_result = poll_resp.json()
    extract_results = poll_result["data"]["extract_result"]
    # 只处理第一个文件
    state = extract_results[0]["state"]
    print(f"当前状态: {state}")
    if state == "done":
        zip_url = extract_results[0]["full_zip_url"]
        print("解析完成，结果下载链接：", zip_url)
        # 下载并解压zip即可获得markdown
        break
    elif state == "failed":
        print("解析失败: ", extract_results[0]["err_msg"])
        break
else:
    print("等待超时，请稍后手动重试")
```
Python 源码如下：
[查看 Python 源码](/assets/pdf2md/pdf2md.py)  

转换成的Markdown效果如下：
[在线查看效果](/2025/09/03/api-demo/view/index.html)


